{"version":3,"sources":["../src/libs/logger.ts"],"names":[],"mappings":"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","file":"logger.js","sourcesContent":["var Gelf = require('gelf');\r\nvar defautConfig:any = {};\r\ntry {\r\n  var config = require('./lib');\r\n  defautConfig = config.graylog;\r\n} catch (e) {\r\n}\r\n\r\nexport class Logger {\r\n  opts:any = {};\r\n  facility: string;\r\n  gelf: any;\r\n  local: string;\r\n\r\n  constructor(options?: any) {\r\n    options = options || {};\r\n    this.opts = Object.assign({\r\n      graylogPort: 12201,\r\n      graylogHostname: '127.0.0.1',\r\n      connection: 'lan',\r\n      maxChunkSizeWan: 1420,\r\n      maxChunkSizeLan: 8154\r\n    }, defautConfig, options);\r\n\r\n    this.local = '';\r\n    if (process.env.logLocal) {\r\n      this.local = process.env.logLocal;\r\n    }\r\n    if (this.local) {\r\n      console.log('start logger with standard log (stdout/stderr)');\r\n    } else {\r\n      console.log('start logger with graylog config:');\r\n      console.log(this.opts);\r\n    }\r\n\r\n\r\n\r\n    this.gelf = new Gelf(this.opts);\r\n\r\n    try {\r\n      let pack = require('../../package.json');\r\n      this.facility = defautConfig.facility || pack.name\r\n    } catch (e) {\r\n      this.facility = defautConfig.facility || 'Unknown NodeJS';\r\n    }\r\n  }\r\n\r\n  emit(l: LogType, short:string, full?:string, other?: any){\r\n    if (!full) {\r\n      full = short\r\n    }\r\n\r\n    let message = {\r\n      \"version\": \"1.0\",\r\n      \"short_message\": short,\r\n      \"full_message\": full,\r\n      \"timestamp\": ~~((new Date()).getTime() / 1000),\r\n      \"level\": l,\r\n      \"facility\": this.facility\r\n    };\r\n    try {\r\n      if (typeof other === 'object' && Object.keys(other).length > 0) {\r\n        message = Object.assign(message, other);\r\n      }\r\n    } catch (e) {\r\n    }\r\n\r\n    if (this.local) {\r\n      this.localLog(l, message);\r\n    } else {\r\n      this.gelf.emit('gelf.log', message);\r\n    }\r\n  }\r\n\r\n  log(short:string, full?:string, other?:any) {\r\n    this.emit(LogType.debug, short, full, other);\r\n  }\r\n\r\n  info(short:string, full?:string, other?:any) {\r\n    this.emit(LogType.info, short, full, other);\r\n  }\r\n\r\n  warn(short:string, full?:string, other?:any) {\r\n    this.emit(LogType.warning, short, full, other);\r\n  }\r\n\r\n  error(short:string, full?:string, other?:any) {\r\n    this.emit(LogType.error, short, full, other);\r\n  }\r\n\r\n  alert(short:string, full?:string, other?:any) {\r\n    this.emit(LogType.alert, short, full, other);\r\n  }\r\n\r\n  private localLog(l: LogType, message:any) {\r\n    var data = '';\r\n    var local = '';\r\n    var isFull = (typeof this.local === 'string' && this.local.toLowerCase() === 'full');\r\n    if (isFull) {\r\n      data = JSON.stringify(message, null, 2);\r\n    } else {\r\n      data = message.short;\r\n    }\r\n\r\n    switch (l) {\r\n      case LogType.debug:\r\n        if (isFull) {\r\n          console.log(new Date());\r\n          console.log(data);\r\n        } else {\r\n          console.log(new Date(), data);\r\n        }\r\n        break;\r\n\r\n      case LogType.info:\r\n      if (isFull) {\r\n        console.info(new Date());\r\n        console.info(data);\r\n      } else {\r\n        console.info(new Date(), data);\r\n      }\r\n      break;\r\n\r\n      case LogType.warning:\r\n        if (isFull) {\r\n          console.warn(new Date());\r\n          console.warn(data);\r\n        } else {\r\n          console.warn(new Date(), data);\r\n        }\r\n        break;\r\n      default:\r\n      if (isFull) {\r\n        console.error(new Date());\r\n        console.error(data);\r\n      } else {\r\n        console.error(new Date(), data);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport enum LogType {\r\n  debug = 1, //logger.log\r\n  info, //logger.info\r\n  notice,\r\n  warning, //logger.warn\r\n  error, //logger.error\r\n  critical,\r\n  alert, //logger.alert\r\n  emergency\r\n}\r\n"]}